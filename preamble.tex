
% Encoding and font
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\renewcommand{\familydefault}{\sfdefault}
\usepackage{textcomp} % symbols
\usepackage{xcolor}

% Page layout
\usepackage{geometry}
\geometry{
  top=6cm,       % space for table header
  bottom=2.5cm,
  left=2.5cm,
  right=2.5cm,
  headheight=120pt
}
\usepackage{setspace}
\usepackage{enumitem}

% Headers and footers
\usepackage{fancyhdr}
\usepackage{lastpage}
\pagestyle{fancy}
\fancyhf{}
\rfoot{\thepage}

% Tables
\usepackage{tabularx,booktabs,array,longtable,calc}
\usepackage{footnote}
\makesavenoteenv{longtable}
\usepackage[edges]{forest}
\usepackage{pdflscape}

% Graphics
\usepackage{graphicx}
\usepackage[export]{adjustbox}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\makeatother
\makeatletter
\def\fps@figure{htbp} % default figure placement
\makeatother

% Links
\usepackage{hyperref}
\hypersetup{
  hidelinks,
  pdfcreator={LaTeX via pandoc}
}
\urlstyle{same}

% Math
\usepackage{amsmath,amssymb}

% Misc
\usepackage{titlesec}
\usepackage{iftex}
\usepackage{subfiles}
\usepackage[normalem]{ulem} % strikethrough support
\usepackage{titling}
\setlength{\droptitle}{-4cm}

% Optional enhancements
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}

% Parskip handling
\makeatletter
\@ifundefined{KOMAClassName}{%
  \setlength{\parindent}{0pt}
  \setlength{\parskip}{6pt plus 2pt minus 1pt}
}{%
  \KOMAoptions{parskip=half}
}
\makeatother

% Custom commands
\newcommand{\todayISO}{%
  \the\year%
  \ifnum\month<10 0\fi\the\month%
  \ifnum\day<10 0\fi\the\day%
}

\newcommand{\includesection}[1]{%
  \clearpage
  \subfile{#1}
}
\newcommand{\dotit}[1]{%
  \def\temp{}%
  \foreach \x in {#1}{\x} % <- expand into chars
}
\renewcommand*\contentsname{Table of Contents:}
\setcounter{secnumdepth}{2}
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Define PBS style
\forestset{
  pbs/.style={
    for tree={
      draw,
      font=\sffamily,
      grow'=south,
      align=left,
      anchor=north,
      % new key to store the number path
      number/.wrap pgfmath arg={#1}{},
      before typesetting nodes={
        if n=1
          { % root
            set number=1,
            content/.wrap value={\forestoption{number}\quad ##1}
          }
          { % children
            tempcount/.option=n,
            set number/.wrap value={\forestoption{parent number}.\the\tempcount},
            content/.wrap value={\forestoption{number}\quad ##1}
          }
      },
    }
  }
  % helper keys
  number/.estore in=\thisnumber,
  parent number/.option=number,
}
% Define style for numbered nodes
\forestset{
  numbered/.style={
    for tree={
      edge={-},
      draw,
      rounded corners,
      minimum width=2.2cm,
      minimum height=0.8cm,
      inner sep=2pt,
      align=center,
      delay={
        mylabel={\parentlab.\forestoption{n}},
        mycount=mycount*10+n,
        content={\mylab\\\dotit{\forestoption{mycount}}\\\hline ##1},
        for children={
          mycount=mycount("!u"),
          % parentlabel={\mylab},
        },
      },
    }
  },
  % helper keys
  mylabel/.store in=\mylab,   % saves any string into \mylab
  mylabel=,                   % default = empty
  mylabel/.default={},        % ensures it works without explicit value
  parentlabel/.store in=\parentlab,   % saves any string into \mylab
  parentlabel=,                   % default = empty
  parentlabel/.default={},        % ensures it works without explicit value
  declare count={mycount}{0},
  declare count={parentCount}{0},
  % number/.estore in=\thisnumber,
  % parent number/.option=number,
}

% Define header
\fancyhead[L]{%
  \renewcommand{\arraystretch}{1.4}
  \begin{tabularx}{\textwidth}{|p{5.5cm}|X|p{5.5cm}|}
    \hline
      % \begin{figure}[h]
      \vspace{0mm}
      \includegraphics[width=5.5cm]{media/inholland_logo.png}
      % \end{figure}
    & \vspace{3mm} \centering \textbf{\large{Inholland Space Lab}} &
    Document \#: ISL-E4SSE-RP-0005 \newline
    Issue: 1.3 \newline
    Date: \todayISO\newline
    Page: \thepage~of~\pageref{LastPage} \\
    \hline
    Security class: TBD &
    Model: TBD &
    Work package: N/A \newline
    Configuration ID: N/A \newline
    Template issue: 1.2 \\
    \hline
  \end{tabularx}%
}
\fancypagestyle{noheader}{
  \fancyhf{}              % clear all header/footer
  \renewcommand{\headrulewidth}{0pt} % remove header line
  % \fancyfoot[L]{\thepage} % keep centered page number
}
